---
layout: post
current: post
cover:  assets/built/images/oracle_linux.png
navigation: True
title: Linux DNS 서버 구축 하기
date: 2023-10-17 00:00:00 +0900
tags: [linux]
class: post-template
subclass: 'post tag-linux'
author: joeyeongjune
---

## Depolying Linux DNS Server

The test environment is Oracle Server 8

### 1. Installing bind package

```
$ sudo dnf install bind bind-chroot bind-utils
```

### 2. named.conf settings

named 데몬의 설정 파일로, DNS 서버를 구축하고자 할 때 가장많이 접근하는 파일로
개별 도메인 설정을 위한 zone파일의 위치, named.ca파일, named.local파일등에 대한 정보가 있다.

```
$ sudo vim /etc/named.conf

  listen-on port 53 { any; };   //Modify
  allow-query { any; };         //Modify
  masterfile-format text;       //Addition
```
![image](https://github.com/joeyeongjune/joeyeongjune.github.io/assets/42788315/f90f1aea-a41b-4543-b9dd-b7a3942f78e0)

  - directory "var/named"
    - DNS 서버에 있는 zone 파일들의 위치를 나타낸다
  - allow-query {any;}
    - 하나의 DNS 서버에는 여러개의 네임서버를 가져올수 있는데, 이 항목을 허용 하겠냐는 것. 즉 추가 네임서버를 허용 할지의 설정

### 3. named.conf validation check

```
$ sudo named-checkconf /etc/named.conf
```
If there is no output, there is no problem

### 4. Add domain zone information

zone 정보 설정 파일인 `named.rfc1912.zones` 에 새로운 도메인과 zone 파일 정보를 기술 한다

```
$ sudo vim /etc/named.rfc1912.zones

・・・
zone "oracle8.local" IN {
        type master;
        file "oracle8.local.zone";
        allow-update { none; };
};
```

### 5. Create zone files and change permissions



```
$ sudo ls -l /var/named/named.localhost
  -rw-r-----. 1 root named 152 Oct  7 02:51 /var/named/named.localhost

$ sudo cp -p /var/named/named.localhost /var/named/oracle8.local.zone
$ sudo ls -l /var/named/oracle8.local.zone
  -rw-r-----. 1 root named 152 Oct  7 02:51 /var/named/oracle8.local.zone
```

### 6. zone file record modification

```
$ sudo vim /var/named/tickle.com.zone

$TTL 1D
@       IN SOA  oracle8.local. root.(
                          0       ; serial
                          1D      ; refresh
                          1H      ; retry
                          1W      ; expire
                          3H )    ; minimum
        IN NS   oracle8.local.
        IN A    192.168.0.200
```

### 7. zone file settings and zone file validation check

```
$ sudo named-checkconf /etc/named.rfc1912.zones
  If there is no output, there is no problem

$ sudo named-checkzone oracle8.local /var/named/oracle8.local.zone
  zone oracle8.local/IN: loaded serial 0
  OK
```

### 8. /etc/resolv.conf DNS 127.0.0.1 registration

```
$ sudo ls -l /etc/resolv.conf
  -rw-r--r--. 1 root root 82 Oct 16 16:50 /etc/resolv.conf
$ sudo cp -p /etc/resolv.conf /etc/resolv.conf.back
$ sudo vim /etc/resolv.conf
  # Generated by NetworkManager
  nameserver 127.0.0.1
  nameserver 58.159.201.244
  nameserver 61.122.116.174
```

![image](https://github.com/joeyeongjune/joeyeongjune.github.io/assets/42788315/60ab6398-fa6b-4e21-ad0a-56bd8925670c)

```
$ nmcli device
  DEVICE   TYPE      STATE      CONNECTION
  enp0s25  ethernet  connected  enp0s25
  lo       loopback  unmanaged  --
  wlo1     wifi      unmanaged  --

$ sudo nmcli con up enp0s25
  Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/2)
```

### 9. Named service restart and service auto-excution registration

```
$ sudo systemctl restart named
$ sudo systemctl enable named
  Created symlink /etc/systemd/system/multi-user.target.wants/named.service → /usr/lib/systemd/system/named.service.
```

### 10. Verify Registered Domain and IP

```
$ nslookup
  > oracle8.local
  Server:         127.0.0.1
  Address:        127.0.0.1#53

  Name:   oracle8.local
  Address: 192.168.0.200
```

### Issues

- [resolv.conf 초기화 현상](https://it-serial.tistory.com/entry/%EB%A6%AC%EB%88%85%EC%8A%A4-DNS-%EC%84%A4%EC%A0%95-%EB%B2%88%EC%99%B8%ED%8E%B8-resolvconf-%ED%8C%8C%EC%9D%BC%EC%B4%88%EA%B8%B0%ED%99%94-%ED%98%84%EC%83%81-%EC%84%A4%EB%AA%85)